FROM eclipse-temurin:11-jdk-noble

ARG version=10.6.4
ARG download_url="https://maven.ontotext.com/repository/owlim-releases/com/ontotext/graphdb/graphdb/${version}/graphdb-${version}-dist.zip"
ARG download_url_checksum="${download_url}.md5"

# Downloading the required packages
RUN apt-get update && \
    apt-get install -u unzip

RUN adduser graphdb

# Downloading GraphDB
RUN curl -fsSL "${download_url}" > graphdb-${version}-dist.zip && \
    bash -c 'md5sum -c - <<<"$(curl -fsSL ${download_url_checksum})  graphdb-${version}-dist.zip"' && \
    unzip graphdb-${version}-dist.zip && \
    rm -f graphdb-${version}-dist.zip


RUN mv graphdb-${version} graphdb && \
    chown -R graphdb /graphdb && \
    mkdir "/opt/graphdb" && \
    chown -R graphdb /opt/graphdb

USER graphdb

ENTRYPOINT ["/graphdb/bin/graphdb"]

CMD ["-Dgraphdb.home=/opt/graphdb/home", "-Dgraphdb.distribution=docker"]

EXPOSE 7200
EXPOSE 7300